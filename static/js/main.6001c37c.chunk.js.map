{"version":3,"sources":["dialer.ts","types.ts","RemoteSession.tsx","Presence.tsx","signaler.ts","AuthorizationModal.tsx","Files.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["MessageReceivedEvent","sender","data","Event","AuthorizationRequestedEvent","resolve","reject","ConnectionEvent","kind","ConnectionClosedEvent","ConnectionReadyEvent","Conn","signaler","id","remoteId","conn","chan","RTCPeerConnection","iceServers","urls","ondatachannel","event","channel","onerror","err","console","error","dispatchEvent","onclose","onopen","onmessage","msg","onicecandidate","candidate","signalCandidate","createDataChannel","this","createOffer","desc","setLocalDescription","debug","sendDescription","close","Promise","success","failure","readyState","removeEventListener","addEventListener","once","addIceCandidate","setRemoteDescription","createAnswer","answer","message","send","EventTarget","Dialer","registered","conns","register","removeConn","from","push","to","informOffer","undefined","find","elt","confirmOffer","Error","filter","forEach","offerCallback","idx","findIndex","splice","all","map","establishedConn","c","init","Payload","chunkNumber","metadata","value","end","encodeBlob","blob","reader","FileReader","onloadend","e","result","toString","readAsDataURL","RemoteSession","props","useState","filename","setFilename","progress","setProgress","name","size","total","progressState","setProgressState","handleChange","files","a","length","file","useEffect","left","JSON","stringify","log","chunk","slice","state","dialer","dial","sessionId","ready","b64","htmlFor","friendlyName","toFixed","type","className","onChange","target","Presence","sessions","setSessions","ev","some","concat","session","SessionEvent","SessionJoinedEvent","SessionLeftEvent","Signaler","mqtt","mqttPresencePrefix","connect","username","password","connectTimeout","clean","resubscribe","clientId","will","retain","payload","qos","topic","protocolId","protocolVersion","on","startsWith","tokens","split","input","parse","descriptionCallback","then","resp","publish","catch","warn","topics","subscribe","v","AuthorizationModal","show","setState","allow","deny","getPeer","onClick","Files","old","chunks","no","complete","sort","b","reduce","acc","cur","download","href","capitalizeFirstLetter","first","rest","locale","navigator","language","toLocaleUpperCase","join","pick","array","Math","floor","random","Array","adjectives","names","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.6001c37c.chunk.js","sourcesContent":["import Signaler, { SessionLeftEvent } from \"./signaler\";\n\nexport class MessageReceivedEvent extends Event {\n  constructor(public sender: string, public data: string) {\n    super(\"message_received\");\n  }\n}\n\nexport class AuthorizationRequestedEvent extends Event {\n  constructor(public sender: string, public resolve: Function, public reject: Function) {\n    super(\"authorization_requested\");\n  }\n}\n\nexport class ConnectionEvent extends Event {\n  constructor(kind: string) {\n    super(`connection_${kind}`)\n  }\n}\n\nexport class ConnectionClosedEvent extends ConnectionEvent {\n  constructor() {\n    super('closed');\n  }\n}\nexport class ConnectionReadyEvent extends ConnectionEvent {\n  constructor() {\n    super('ready');\n  }\n}\n\n\nexport class Conn extends EventTarget {\n  private conn: RTCPeerConnection;\n  private chan: RTCDataChannel;\n  constructor(private signaler: Signaler, private id: string, private remoteId: string) {\n    super();\n    this.signaler = signaler;\n    this.id = id;\n    this.remoteId = remoteId;\n    const defaults = {\n      config: { iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }] },\n      debug: 3,\n    };\n    this.conn = new RTCPeerConnection(defaults.config);\n    this.conn.ondatachannel = (event) => {\n      event.channel.onerror = (err) => {\n        console.error(err)\n        this.dispatchEvent(new ConnectionClosedEvent())\n      }\n      event.channel.onclose = (err) => {\n        this.dispatchEvent(new ConnectionClosedEvent())\n      }\n      event.channel.onopen = () => {\n        this.dispatchEvent(new ConnectionReadyEvent())\n      };\n      event.channel.onmessage = (msg) => {\n        this.dispatchEvent(new MessageReceivedEvent(this.remoteId, msg.data));\n      };\n    };\n    this.conn.onicecandidate = (event) => {\n      if (event.candidate) {\n        this.signaler.signalCandidate(this.remoteId, event.candidate);\n      }\n    };\n    this.chan = this.conn.createDataChannel(`io.pushr.channels.send.${id}-${remoteId}`);\n\n  }\n  async init() {\n    const desc = await this.conn.createOffer();\n    this.conn.setLocalDescription(desc);\n    console.debug(this.remoteId, 'sending description')\n    return this.signaler.sendDescription(this.remoteId, desc);\n  }\n  close() {\n    this.chan.close();\n  }\n  async ready(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (this.chan.readyState === \"open\") {\n        resolve();\n        return\n      }\n      let success: EventListener, failure: EventListener;\n\n      success = () => { this.removeEventListener('connection_closed', failure); resolve() };\n      failure = () => { this.removeEventListener('connection_ready', success); reject() };\n\n      console.debug('waiting for conn to be ready. current state is', this.chan.readyState)\n      this.addEventListener('connection_ready', success, { once: true });\n      this.addEventListener('connection_closed', failure, { once: true });\n\n    });\n  }\n  async addIceCandidate(candidate: RTCIceCandidate | RTCIceCandidateInit) {\n    if (candidate !== null) {\n      console.debug(this.remoteId, 'received ice candidate', candidate)\n      try {\n        this.conn.addIceCandidate(candidate);\n      } catch (err) {\n        console.error(err)\n      }\n    }\n  }\n  async informOffer(desc: RTCSessionDescriptionInit) {\n    console.debug(this.remoteId, 'received remote description', desc)\n    this.conn.setRemoteDescription(desc);\n    const answer = await this.conn.createAnswer();\n    this.conn.setLocalDescription(answer);\n    console.debug(this.remoteId, 'description exchange complete')\n    return answer;\n  }\n  offerCallback(desc: RTCSessionDescriptionInit) {\n    this.conn.setRemoteDescription(desc);\n    console.debug(this.remoteId, 'description exchange complete')\n  }\n  send(message: string) {\n    return this.chan.send(message);\n  }\n}\n\ninterface establishedConn {\n  to: string;\n  from: string;\n  conn: Conn;\n}\n\nexport class Dialer extends EventTarget {\n  private registered = false;\n  private conns: establishedConn[];\n\n  constructor(private signaler: Signaler, private id: string) {\n    super();\n    this.signaler = signaler;\n    this.conns = [];\n    this.id = id;\n  }\n  register() {\n    this.signaler.register(this);\n    this.signaler.addEventListener('session_left', ((event: SessionLeftEvent) => {\n      this.removeConn(event.id);\n    }) as EventListener)\n    this.registered = true;\n  }\n  async confirmOffer(from: string, desc: RTCSessionDescriptionInit) {\n    const conn = new Conn(this.signaler, this.id, from);\n    conn.addEventListener('connection_closed', (() => {\n      this.removeConn(from);\n    }) as EventListener);\n\n    conn.addEventListener(\"message_received\", ((event: MessageReceivedEvent) => {\n      this.dispatchEvent(new MessageReceivedEvent(event.sender, event.data))\n    }) as EventListener);\n\n    this.conns.push({ from: from, to: this.id, conn: conn });\n    return conn.informOffer(desc);\n  }\n  async informOffer(from: string, desc: RTCSessionDescriptionInit) {\n    let establishedConn = this.conns.find(elt => elt.from === from);\n    if (establishedConn !== undefined) { return }\n    try {\n      await new Promise((resolve, reject) => {\n        this.dispatchEvent(new AuthorizationRequestedEvent(from, resolve, reject));\n      })\n      return this.confirmOffer(from, desc);\n    } catch {\n      throw new Error('permission denied')\n    }\n  }\n  descriptionCallback(from: string, desc: RTCSessionDescriptionInit) {\n    this.conns\n      .filter((elt) => elt.to === from)\n      .forEach((elt) => {\n        elt.conn.offerCallback(desc);\n      });\n  }\n  removeConn(to: string) {\n    let idx = this.conns.findIndex(elt => elt.to === to);\n    if (idx < 0) { return }\n    this.conns[idx].conn.close();\n    this.conns.splice(idx, 1);\n\n    idx = this.conns.findIndex(elt => elt.from === to);\n    if (idx < 0) { return }\n    this.conns[idx].conn.close();\n    this.conns.splice(idx, 1);\n\n    console.debug(`removed connection to ${to}`)\n  }\n  async addIceCandidate(from: string, candidate: RTCIceCandidate | RTCIceCandidateInit) {\n    return Promise.all(this.conns\n      .filter((elt) => elt.to === from)\n      .map(elt => elt.conn.addIceCandidate(candidate)));\n  }\n  async dial(remoteId: string) {\n    if (!this.registered) {\n      throw new Error(\"dialer not registered\")\n    }\n    let establishedConn = this.conns.find(elt => elt.to === remoteId);\n    if (establishedConn !== undefined) { return establishedConn.conn }\n    console.debug('conn to', remoteId, 'not found: dialing a new one')\n    const c = new Conn(this.signaler, this.id, remoteId);\n    this.conns.push({ from: this.id, to: remoteId, conn: c });\n    c.addEventListener('connection_closed', (() => {\n      this.removeConn(remoteId);\n    }) as EventListener);\n    await c.init();\n    console.debug(remoteId, 'conn init done')\n    return c;\n  }\n}\n","export class Payload {\n  constructor(\n    public chunkNumber: number,\n    public metadata: Metadata,\n    public value: string,\n    public end: boolean,\n  ) { }\n}\n\nexport interface Metadata {\n  name: string;\n  size: number;\n}\n","import { useEffect, useState } from \"react\";\nimport { Conn, Dialer } from \"./dialer\";\nimport { Metadata, Payload } from \"./types\";\n\nexport interface RemoteSessionProps {\n  sessionId: string;\n  friendlyName: string;\n  dialer: Dialer;\n}\n\ninterface progressState {\n  conn?: Conn;\n  value: string;\n  metadata: Metadata;\n  chunkNumber: number;\n  total: number;\n}\n\nconst percentage = (total: number, left: number): number =>\n  (((total - left) / total) * 100);\n\nconst encodeBlob = (blob: Blob): Promise<string> => {\n  return new Promise((resolve) => {\n    const reader = new FileReader();\n    reader.onloadend = function (e) {\n      if (reader.result) {\n        resolve(reader.result.toString());\n      }\n    };\n    reader.readAsDataURL(blob);\n  });\n};\n\nconst chunkSize = 1000;\n\nexport const RemoteSession = (props: RemoteSessionProps) => {\n  const [filename, setFilename] = useState<string>(\"\");\n  const [progress, setProgress] = useState(0);\n  const [progressState, setProgressState] = useState<progressState>({\n    chunkNumber: 0,\n    conn: undefined,\n    metadata: { name: \"\", size: 0 },\n    total: 0,\n    value: \"\",\n  });\n\n  const handleSubmit = (e: React.ChangeEvent<HTMLInputElement>) => {\n    handleChange(e.target.files);\n  };\n  const handleChange = async (files: FileList | null) => {\n    if (files === null || files.length === 0) {\n      setFilename(\"\");\n      setProgress(0);\n      return;\n    }\n    const file = files[0];\n    setFilename(file.name);\n    await send({ name: file.name, size: file.size }, file);\n  };\n\n  useEffect(() => {\n    if (!progressState.conn){ return }\n    setProgress(percentage(progressState.total, progressState.value.length));\n    if (progressState.value.length === 0) {\n      progressState.conn.send(\n        JSON.stringify(\n          new Payload(\n            progressState.chunkNumber,\n            progressState.metadata,\n            \"\",\n            true\n          )\n        )\n      );\n      console.log(\"send complete\");\n      return;\n    }\n    const chunk = progressState.value.slice(0, chunkSize);\n    progressState.conn.send(\n      JSON.stringify(\n        new Payload(\n          progressState.chunkNumber,\n          progressState.metadata,\n          chunk,\n          false\n        )\n      )\n    );\n    setProgressState((state) => ({\n      chunkNumber: state.chunkNumber + 1,\n      conn: state.conn,\n      metadata: state.metadata,\n      value: state.value.slice(chunk.length),\n      total: state.total,\n    }));\n  }, [progressState]);\n\n  const send = async (metadata: Metadata, data: Blob) => {\n    const conn = await props.dialer.dial(props.sessionId);\n    await conn.ready();\n    const b64 = await encodeBlob(data);\n    setProgressState({\n      chunkNumber: 0,\n      conn: conn,\n      metadata: metadata,\n      value: b64,\n      total: b64.length,\n    });\n  };\n\n  return (\n    <label htmlFor={props.sessionId}>\n      <div>{props.friendlyName}</div>\n      {filename !== \"\" ? (\n        <div>\n          {filename} ({progress.toFixed(2)}%)\n        </div>\n      ) : null}\n      <input\n        type=\"file\"\n        className=\"remote-session-input\"\n        id={props.sessionId}\n        onChange={handleSubmit}\n      />\n    </label>\n  );\n};\n","import { useEffect, useState } from \"react\";\nimport { Dialer } from \"./dialer\";\nimport { RemoteSession } from \"./RemoteSession\";\nimport Signaler, { SessionJoinedEvent, SessionLeftEvent } from \"./signaler\";\n\nexport interface PresenceProps {\n  id: string;\n  friendlyName: string;\n  dialer: Dialer;\n  signaler: Signaler;\n}\ninterface session {\n  id: string;\n  friendlyName: string;\n}\nexport const Presence = (props: PresenceProps) => {\n  const [sessions, setSessions] = useState<session[]>([]);\n  useEffect(() => {\n    props.signaler.addEventListener(\"session_joined\", ((\n      ev: SessionJoinedEvent\n    ) => {\n      console.debug(\"session\", ev.id, \"joined\");\n      setSessions((sessions) => {\n        if (!sessions.some((elt) => elt.id === ev.id)) {\n          return sessions.concat({ id: ev.id, friendlyName: ev.friendlyName });\n        }\n        return sessions;\n      });\n    }) as EventListener);\n\n    props.signaler.addEventListener(\"session_left\", ((ev: SessionLeftEvent) => {\n      console.debug(\"session\", ev.id, \"left\");\n      setSessions((sessions) => sessions.filter((elt) => elt.id !== ev.id));\n    }) as EventListener);\n  }, [props]);\n\n  return (\n    <div className=\"presence\">\n      {sessions\n        .filter((session) => session.id !== props.id)\n        .map((session) => (\n          <RemoteSession\n            key={session.id}\n            dialer={props.dialer}\n            sessionId={session.id}\n            friendlyName={session.friendlyName}\n          />\n        ))}\n    </div>\n  );\n};\n","import mqtt from \"mqtt\";\n\nconst qosLevel = 2;\n\nexport class SessionEvent extends Event {\n  id: string;\n  constructor(kind: string, id: string) {\n    super(`session_${kind}`);\n    this.id = id;\n  }\n}\n\nexport class SessionJoinedEvent extends SessionEvent {\n  friendlyName: string;\n  constructor(id: string, friendlyName: string) {\n    super(\"joined\", id);\n    this.friendlyName = friendlyName;\n  }\n}\nexport class SessionLeftEvent extends SessionEvent {\n  constructor(id: string) {\n    super(\"left\", id);\n  }\n}\n\ninterface session {\n  id: string;\n  name: string;\n}\nexport default class Signaler extends EventTarget {\n  private dialer: any;\n  private mqtt: mqtt.MqttClient;\n  private sessions: session[] = [];\n\n  close() {\n    this.mqtt.end(true);\n  }\n  getPeer(id: string): session {\n    const v = this.sessions.find(elt => elt.id === id)\n    if (v === undefined) { return { id: id, name: ' Unknown' } }\n    return v;\n  }\n  constructor(private id: string, private name: string) {\n    super();\n    const mqttPresencePrefix = `sessions/`;\n    this.mqtt = mqtt.connect(\"wss://broker.iot.cloud.vx-labs.net/mqtt\", {\n      username: \"julien@bonachera.fr/pushr/browser\",\n      password: \"VeryPasswordMuchSecureWow\",\n      connectTimeout: 30 * 1000,\n      clean: true,\n      resubscribe: false,\n      clientId: `pushr_${id}`,\n      will: {\n        retain: true,\n        payload: '',\n        qos: qosLevel,\n        topic: `sessions/${this.id}`,\n      },\n      protocolId: 'MQIsdp',\n      protocolVersion: 3\n    });\n    this.mqtt.on(\"message\", (topic, payload) => {\n      //console.debug(`${topic} -> ${payload.toString()}`);\n      if (topic.startsWith(mqttPresencePrefix)) {\n        topic = topic.slice(mqttPresencePrefix.length);\n        const tokens = topic.split(\"/\");\n        if (tokens.length === 1) {\n          const sessionId = tokens[0];\n          if (payload.length === 0) {\n            if (this.sessions.some(elt => elt.id === sessionId)) {\n              this.sessions = this.sessions.filter(elt => elt.id !== sessionId)\n            }\n            this.dispatchEvent(new SessionLeftEvent(sessionId));\n          } else {\n            const input = JSON.parse(payload.toString())\n            if (!this.sessions.some(elt => elt.id === sessionId)) {\n              this.sessions.push({ id: sessionId, name: input.name })\n            }\n            this.dispatchEvent(new SessionJoinedEvent(sessionId, input.name));\n          }\n        } else if (topic.startsWith(this.id)) {\n          // RPC\n          if (this.dialer === undefined) {\n            console.error('dropped packet: dialer not registered')\n            return;\n          }\n          topic = topic.slice(this.id.length + 1);\n          switch (topic) {\n            case \"candidate\":\n              {\n                const msg = JSON.parse(payload.toString());\n                this.dialer.addIceCandidate(msg.from, msg.candidate);\n              }\n              break;\n            case \"description_denied\":\n              {\n                const msg = JSON.parse(payload.toString());\n                this.dialer.removeConn(msg.from);\n              }\n              break;\n            case \"description_answer\":\n              {\n                const msg = JSON.parse(payload.toString());\n                this.dialer.descriptionCallback(msg.from, msg.desc);\n              }\n              break;\n            case \"description\":\n              {\n                const msg = JSON.parse(payload.toString());\n                this.dialer\n                  .informOffer(msg.from, msg.desc)\n                  .then((resp: any) => {\n                    this.mqtt.publish(\n                      `sessions/${msg.from}/description_answer`,\n                      JSON.stringify({ from: this.id, desc: resp }),\n                      { qos: qosLevel }\n                    );\n                  })\n                  .catch(() => {\n                    this.mqtt.publish(\n                      `sessions/${msg.from}/description_denied`,\n                      JSON.stringify({ from: this.id, }),\n                      { qos: qosLevel }\n                    );\n                  });\n              }\n              break;\n            default:\n              console.warn(\"unknown rpc received:\", topic);\n          }\n        }\n      }\n    });\n    this.mqtt.on(\"connect\", async () => {\n      const topics = [\n        `sessions/${this.id}/+`,\n        `sessions/+`\n      ]\n\n      this.mqtt.subscribe(topics, { qos: qosLevel }, (err) => {\n        if (err) {\n          console.error(\"presence setup failed\", err)\n          return\n        }\n        console.log('presence setup')\n        this.mqtt.publish(`sessions/${this.id}`, JSON.stringify({ id: this.id, name: this.name }), {\n          qos: qosLevel,\n          retain: true,\n        }, (err) => {\n          if (err) {\n            console.error(err)\n          }\n        });\n      });\n      console.debug('connection to mqtt broker established')\n    });\n  }\n\n  register(dialer: any) {\n    this.dialer = dialer;\n  }\n\n  async signalCandidate(to: string, candidate: any): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.mqtt.publish(\n        `sessions/${to}/candidate`,\n        JSON.stringify({\n          candidate,\n          from: this.id,\n        }),\n        { qos: qosLevel },\n        (err) => {\n          if (err) {\n            reject(err);\n          } else {\n            resolve();\n          }\n        }\n      );\n    });\n  }\n  async sendDescription(to: string, desc: any): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.mqtt.publish(\n        `sessions/${to}/description`,\n        JSON.stringify({ from: this.id, desc: desc }),\n        { qos: qosLevel },\n        (err) => {\n          if (err) {\n            reject(err);\n          } else {\n            resolve();\n          }\n        }\n      );\n    });\n  }\n}\n","import { useEffect, useState } from \"react\";\nimport { AuthorizationRequestedEvent, Dialer } from \"./dialer\";\nimport Signaler from \"./signaler\";\n\nexport interface AuthorizationModalProps {\n  dialer: Dialer;\n  signaler: Signaler;\n}\ninterface state {\n  show: Boolean;\n  from?: string;\n  allow?: () => void;\n  deny?: () => void;\n}\n\nexport const AuthorizationModal = (props: AuthorizationModalProps) => {\n  const [state, setState] = useState<state>({ show: false });\n\n  useEffect(() => {\n    props.dialer.addEventListener(\"authorization_requested\", ((\n      ev: AuthorizationRequestedEvent\n    ) => {\n      console.log(`${ev.sender} requested authorization`);\n      setState(() => ({\n        show: true,\n        allow: () => {\n          setState({ show: false });\n          ev.resolve();\n        },\n        deny: () => {\n          setState({ show: false });\n          ev.reject();\n        },\n        from: props.signaler.getPeer(ev.sender).name,\n      }));\n    }) as EventListener);\n  }, [props]);\n\n  return !state.show ? null : (\n    <div className=\"modal-overlay\">\n      <div className=\"modal\">\n        <div>{state.from} requested authorization.</div>\n        <div>\n          <button onClick={state.allow}>Allow</button>\n          <button onClick={state.deny}>Deny</button>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { useEffect, useState } from \"react\";\nimport { Dialer, MessageReceivedEvent } from \"./dialer\";\nimport { Payload } from \"./types\";\n\nexport interface FileProps {\n  dialer: Dialer;\n}\n\ninterface receivedFile {\n  name: string;\n  from: string;\n  size: number;\n  value: string;\n  chunks: { no: number; value: string }[];\n  complete: boolean;\n}\n\nexport const Files = (props: FileProps) => {\n  const [state, setState] = useState<receivedFile[]>([]);\n\n  useEffect(() => {\n    props.dialer.addEventListener(\"message_received\", ((\n      ev: MessageReceivedEvent\n    ) => {\n      try {\n        const payload = JSON.parse(ev.data) as Payload;\n\n        setState((state: receivedFile[]) => {\n          const files = state.slice();\n          const old = files.find(\n            (elt) =>\n              elt.from === ev.sender && elt.name === payload.metadata.name\n          );\n          if (old !== undefined) {\n            if (payload.end) {\n              old.value = old.chunks\n                .sort((a, b) => a.no - b.no)\n                .reduce((acc, cur) => acc + cur.value, \"\");\n              old.complete = true;\n            } else {\n              //console.log(\"appending chunk\", payload.chunkNumber);\n              if (!old.chunks.some((elt) => elt.no === payload.chunkNumber)) {\n                old.chunks = old.chunks.concat({\n                  no: payload.chunkNumber,\n                  value: payload.value,\n                });\n              }\n            }\n          } else {\n            console.log(\"creating chunk\", payload.chunkNumber);\n            return files.concat({\n              from: ev.sender,\n              chunks: [{ no: payload.chunkNumber, value: payload.value }],\n              value: \"\",\n              size: payload.metadata.size,\n              name: payload.metadata.name,\n              complete: false,\n            });\n          }\n          return files;\n        });\n      } catch (err) {\n        console.log(\"failed:\", err);\n      }\n    }) as EventListener);\n  }, [props.dialer]);\n\n  return (\n    <div>\n      Files:{\" \"}\n      {state\n        .filter((elt) => elt.complete)\n        .map((elt) => (\n          <a download={elt.name} href={elt.value} key={elt.from + elt.name}>\n            {elt.name}\n          </a>\n        ))}\n    </div>\n  );\n};\n","import React from \"react\";\nimport \"./App.css\";\nimport names from \"./assets/names.json\";\nimport adjectives from \"./assets/adjectives.json\";\nimport { Dialer } from \"./dialer\";\nimport { Presence } from \"./Presence\";\nimport Signaler from \"./signaler\";\nimport { AuthorizationModal } from \"./AuthorizationModal\";\nimport { Files } from \"./Files\";\n\n\nconst getID = (): string => {\n  return [...Array(8)]\n    .map(() => (~~(Math.random() * 36)).toString(36))\n    .join(\"\");\n};\n\n\nconst capitalizeFirstLetter = (\n  [first, ...rest]: string,\n  locale = navigator.language\n) => {\n  return [first.toLocaleUpperCase(locale), ...rest].join(\"\");\n};\n\nconst pick = (array: string[]): string => {\n  return array[Math.floor(Math.random() * array.length)];\n};\n\nconst getName = (): string => {\n  return `${capitalizeFirstLetter(pick(adjectives))} ${capitalizeFirstLetter(\n    pick(names)\n  )}`;\n};\n\nconst id = getID();\nconst name = getName();\n\nconst signaler = new Signaler(id, name);\n\nconst dialer = new Dialer(signaler, id);\ndialer.register();\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <AuthorizationModal\n        signaler={signaler}\n        dialer={dialer}\n      ></AuthorizationModal>\n      <div className=\"peers\">\n        <Presence\n          dialer={dialer}\n          friendlyName={name}\n          signaler={signaler}\n          id={id}\n        />\n      </div>\n      <div className=\"self\">\n        <div>I am {name}</div>\n        <Files dialer={dialer}></Files>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}